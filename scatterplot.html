<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Scatterplot chart Example</title>
    <style>
      #chart {
        width: 928px;
        height: 600px;
      }
    </style>
  </head>
  <body>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="scatterplot.js"></script>
    <div id="chart"></div>
    <script type="module">
      async function createScatterPlot() {
        let data = await getScatterData();
        if (!data || !data.length) {
          console.error("Check data in scatterplot.js");
          return;
        }
        const width = 928;
        const height = 600;
        const marginTop = 20;
        const marginRight = 30;
        const marginBottom = 30;
        const marginLeft = 40;

        // Create the horizontal (x) scale for money income
        const x = d3
          .scaleLinear()
          .domain([0, d3.max(data, (d) => d["value"])])
          .nice()
          .range([marginLeft, width - marginRight])
          .unknown(marginLeft);

        // Create the vertical (y) scale for obesity
        const y = d3
          .scaleLinear()
          .domain([0, d3.max(data, (d) => d["obesity"])])
          .nice()
          .range([height - marginBottom, marginTop])
          .unknown(height - marginBottom);

        // Define color scale for different income types
        const color = d3
          .scaleOrdinal()
          .domain(["Households", "Families", "Married-couple", "Nonfamily"])
          .range(["steelblue", "orange", "green", "purple"]);

        // Create the SVG container
        const svg = d3
          .create("svg")
          .attr("viewBox", [0, 0, width, height])
          .property("value", []);

        // Append the x-axis (money income)
        svg
          .append("g")
          .attr("transform", `translate(0,${height - marginBottom})`)
          .call(d3.axisBottom(x))
          .call((g) => g.select(".domain").remove())
          .call((g) =>
            g
              .append("text")
              .attr("x", width - marginRight)
              .attr("y", -4)
              .attr("fill", "#000")
              .attr("font-weight", "bold")
              .attr("text-anchor", "end")
              .text("Money Income (dollars)")
          );

        // Append the y-axis (obesity)
        svg
          .append("g")
          .attr("transform", `translate(${marginLeft},0)`)
          .call(d3.axisLeft(y))
          .call((g) => g.select(".domain").remove())
          .call((g) =>
            g
              .select(".tick:last-of-type text")
              .clone()
              .attr("x", 4)
              .attr("text-anchor", "start")
              .attr("font-weight", "bold")
              .text("Obesity (%)")
          );

        // Append the dots with different colors and symbol

        const dot = svg
          .append("g")
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-width", 1.5)
          .selectAll("circle")
          .data(data)
          .join("circle")
          .attr(
            "transform",
            (d) =>
              `translate(${x(d["value"])},${y(d["obesity"])})`
          )
          .attr("fill", (d) => color(d["incomeType"]))
          .attr("r", 3);

        // Add legend for income types
        const legend = svg
          .append("g")
          .attr("transform", `translate(${width - 150}, ${marginTop})`);

        const incomeTypes = [
          "Households",
          "Families",
          "Married-couple",
          "Nonfamily",
        ];
        incomeTypes.forEach((type, i) => {
          const legendRow = legend
            .append("g")
            .attr("transform", `translate(0, ${i * 20})`);

          legendRow
            .append("circle")
            .attr("cx", 10)
            .attr("cy", 5)
            .attr("r", 5)
            .attr("fill", color(type))
            .attr("stroke", "none");

          legendRow
            .append("text")
            .attr("x", 20)
            .attr("y", 5)
            .attr("font-size", "12px")
            .text(type);
        });

        return svg.node(); // Return the SVG node
      }

      createScatterPlot().then((node) => {
        if (node) {
          document.getElementById("chart").appendChild(node);
        }
      });
    </script>
  </body>
</html>
